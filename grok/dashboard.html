<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - Ticketing System - HowlWare</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
  </head>
  <body class="bg-light">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="index.html">HowlWare</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="dashboard.html">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="ticketing.html">Ticketing System</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="reports.html">Reports</a>
            </li>
          </ul>
          <div class="d-flex">
            <a href="profile.html" class="btn btn-outline-light me-2">Profile</a>
            <a href="logout.html" class="btn btn-outline-light">Logout</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container my-5">
      <h2 class="mb-4 text-center">Ticketing System Dashboard</h2>

      <!-- Overview Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-white bg-info mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Tickets</h5>
              <p class="card-text display-4" id="total-tickets">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-success mb-3">
            <div class="card-body">
              <h5 class="card-title">Open Tickets</h5>
              <p class="card-text display-4" id="open-tickets">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-warning mb-3">
            <div class="card-body">
              <h5 class="card-title">Pending Tickets</h5>
              <p class="card-text display-4" id="pending-tickets">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-danger mb-3">
            <div class="card-body">
              <h5 class="card-title">Closed Tickets</h5>
              <p class="card-text display-4" id="closed-tickets">0</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row mb-4">
        <!-- Tickets Over Time -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header bg-primary text-white">
              Tickets Over Time
            </div>
            <div class="card-body">
              <canvas id="ticketsOverTimeChart"></canvas>
            </div>
          </div>
        </div>
        <!-- Tickets by Priority -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header bg-success text-white">
              Tickets by Priority
            </div>
            <div class="card-body">
              <canvas id="ticketsByPriorityChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <!-- Tickets by Department -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header bg-warning text-white">
              Tickets by Department
            </div>
            <div class="card-body">
              <canvas id="ticketsByDepartmentChart"></canvas>
            </div>
          </div>
        </div>
        <!-- Additional Charts or Widgets can be added here -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header bg-secondary text-white">
              Top Performing Departments
            </div>
            <div class="card-body">
              <canvas id="topDepartmentsChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Tickets Table -->
      <div class="card">
        <div class="card-header bg-primary text-white">
          Recent Tickets
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="table-light">
                <tr>
                  <th scope="col">Ticket ID</th>
                  <th scope="col">Subject</th>
                  <th scope="col">Priority</th>
                  <th scope="col">Status</th>
                  <th scope="col">Created By</th>
                  <th scope="col">Created At</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="recent-tickets">
                <!-- Recent tickets will be injected here by JavaScript -->
              </tbody>
            </table>
          </div>
          <div class="d-flex justify-content-end">
            <a href="ticketing.html" class="btn btn-primary">View All Tickets</a>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white pt-4">
      <div class="container">
        <div class="row">
          <!-- About Section -->
          <div class="col-md-4">
            <h5>About HowlWare</h5>
            <p>
              HowlWare specializes in advanced cybersecurity solutions, providing reliable and innovative tools to protect your digital assets.
            </p>
          </div>
          <!-- Quick Links -->
          <div class="col-md-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
              <li><a href="index.html" class="text-white text-decoration-none">Home</a></li>
              <li><a href="About.html" class="text-white text-decoration-none">About</a></li>
              <li><a href="support.html" class="text-white text-decoration-none">Support</a></li>
              <li><a href="contact.html" class="text-white text-decoration-none">Contact</a></li>
            </ul>
          </div>
          <!-- Contact Information -->
          <div class="col-md-4">
            <h5>Contact Us</h5>
            <p>
              123 Cybersecurity Ave.<br>
              Tech City, TC 12345<br>
              Email: <a href="mailto:info@howlware.com" class="text-white text-decoration-none">info@howlware.com</a><br>
              Phone: (123) 456-7890
            </p>
          </div>
        </div>
        <hr class="bg-secondary">
        <div class="text-center pb-3">
          &copy; 2024 HowlWare. All rights reserved.
        </div>
      </div>
    </footer>

    <!-- Dashboard JavaScript -->
    <script>
      // Sample Data (Replace with dynamic data from your database)
      let tickets = [
        {
          id: 1,
          subject: "Cannot access VPN",
          priority: "High",
          status: "Open",
          createdBy: "AdminUser",
          createdAt: "2024-04-01 10:30 AM",
          department: "IT Support"
        },
        {
          id: 2,
          subject: "Software installation request",
          priority: "Medium",
          status: "Pending",
          createdBy: "JohnDoe",
          createdAt: "2024-04-02 02:15 PM",
          department: "Software Team"
        },
        // Add more sample tickets as needed
      ];

      // Function to render overview cards
      function renderOverview() {
        const total = tickets.length;
        const open = tickets.filter(ticket => ticket.status === "Open").length;
        const pending = tickets.filter(ticket => ticket.status === "Pending").length;
        const closed = tickets.filter(ticket => ticket.status === "Closed").length;

        document.getElementById('total-tickets').textContent = total;
        document.getElementById('open-tickets').textContent = open;
        document.getElementById('pending-tickets').textContent = pending;
        document.getElementById('closed-tickets').textContent = closed;
      }

      // Function to render recent tickets
      function renderRecentTickets() {
        const recentTickets = tickets.slice(-5).reverse(); // Get last 5 tickets
        const recentTicketsContainer = document.getElementById('recent-tickets');
        recentTicketsContainer.innerHTML = ''; // Clear existing rows

        recentTickets.forEach(ticket => {
          const tr = document.createElement('tr');

          tr.innerHTML = `
            <td>${ticket.id}</td>
            <td>${ticket.subject}</td>
            <td>${ticket.priority}</td>
            <td>${ticket.status}</td>
            <td>${ticket.createdBy}</td>
            <td>${ticket.createdAt}</td>
            <td>
              <button class="btn btn-sm btn-info me-1" onclick="viewTicket(${ticket.id})">View</button>
              <button class="btn btn-sm btn-warning me-1" onclick="editTicket(${ticket.id})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteTicket(${ticket.id})">Delete</button>
            </td>
          `;

          recentTicketsContainer.appendChild(tr);
        });
      }

      // Function to render charts
      function renderCharts() {
        // Tickets Over Time Data Preparation
        const ticketsOverTimeData = {}; // e.g., { '2024-04-01': 5, '2024-04-02': 3, ... }
        tickets.forEach(ticket => {
          const date = ticket.createdAt.split(' ')[0]; // Extract date
          if (ticketsOverTimeData[date]) {
            ticketsOverTimeData[date]++;
          } else {
            ticketsOverTimeData[date] = 1;
          }
        });

        const dates = Object.keys(ticketsOverTimeData).sort();
        const ticketCounts = dates.map(date => ticketsOverTimeData[date]);

        // Tickets Over Time Chart
        const ctx1 = document.getElementById('ticketsOverTimeChart').getContext('2d');
        new Chart(ctx1, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'Tickets Created',
              data: ticketCounts,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1,
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: false,
                text: 'Tickets Over Time'
              }
            }
          }
        });

        // Tickets by Priority Data Preparation
        const priorityCounts = tickets.reduce((acc, ticket) => {
          acc[ticket.priority] = (acc[ticket.priority] || 0) + 1;
          return acc;
        }, {});

        // Tickets by Priority Chart
        const ctx2 = document.getElementById('ticketsByPriorityChart').getContext('2d');
        new Chart(ctx2, {
          type: 'pie',
          data: {
            labels: Object.keys(priorityCounts),
            datasets: [{
              label: 'Tickets by Priority',
              data: Object.values(priorityCounts),
              backgroundColor: [
                'rgba(75, 192, 192, 0.6)', // Medium
                'rgba(255, 206, 86, 0.6)', // Low
                'rgba(255, 99, 132, 0.6)'  // High
              ],
              borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255, 99, 132, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: false,
                text: 'Tickets by Priority'
              }
            }
          }
        });

        // Tickets by Department Data Preparation
        const departmentCounts = tickets.reduce((acc, ticket) => {
          acc[ticket.department] = (acc[ticket.department] || 0) + 1;
          return acc;
        }, {});

        // Tickets by Department Chart
        const ctx3 = document.getElementById('ticketsByDepartmentChart').getContext('2d');
        new Chart(ctx3, {
          type: 'bar',
          data: {
            labels: Object.keys(departmentCounts),
            datasets: [{
              label: 'Tickets by Department',
              data: Object.values(departmentCounts),
              backgroundColor: 'rgba(153, 102, 255, 0.6)',
              borderColor: 'rgba(153, 102, 255, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
              title: {
                display: false,
                text: 'Tickets by Department'
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision:0
                }
              }
            }
          }
        });

        // Top Performing Departments (Sample Data)
        const topDepartments = {
          'IT Support': 10,
          'Software Team': 7,
          'Customer Service': 5,
          'HR': 3
        };

        // Top Departments Chart
        const ctx4 = document.getElementById('topDepartmentsChart').getContext('2d');
        new Chart(ctx4, {
          type: 'horizontalBar', // Note: 'horizontalBar' is deprecated in Chart.js v3+, use 'bar' with indexAxis: 'y'
          data: {
            labels: Object.keys(topDepartments),
            datasets: [{
              label: 'Tickets Handled',
              data: Object.values(topDepartments),
              backgroundColor: 'rgba(255, 159, 64, 0.6)',
              borderColor: 'rgba(255, 159, 64, 1)',
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y', // Makes the bar chart horizontal
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
              title: {
                display: false,
                text: 'Top Performing Departments'
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                ticks: {
                  precision:0
                }
              }
            }
          }
        });
      }

      // Function to view ticket details
      function viewTicket(id) {
        const ticket = tickets.find(t => t.id === id);
        if (ticket) {
          alert(`Ticket ID: ${ticket.id}\nSubject: ${ticket.subject}\nPriority: ${ticket.priority}\nStatus: ${ticket.status}\nCreated By: ${ticket.createdBy}\nCreated At: ${ticket.createdAt}\nDepartment: ${ticket.department}`);
        }
      }

      // Function to edit a ticket
      function editTicket(id) {
        const ticket = tickets.find(t => t.id === id);
        if (ticket) {
          const newStatus = prompt("Enter new status (Open, Pending, Closed):", ticket.status);
          if (newStatus && ["Open", "Pending", "Closed"].includes(newStatus)) {
            ticket.status = newStatus;
            renderOverview();
            renderRecentTickets();
            // Update charts if necessary
            // In a real application, send update to the server here
          } else {
            alert("Invalid status entered.");
          }
        }
      }

      // Function to delete a ticket
      function deleteTicket(id) {
        if (confirm("Are you sure you want to delete this ticket?")) {
          tickets = tickets.filter(t => t.id !== id);
          renderOverview();
          renderRecentTickets();
          // Update charts if necessary
          // In a real application, send delete request to the server here
        }
      }

      // Initialize the dashboard
      document.addEventListener('DOMContentLoaded', () => {
        renderOverview();
        renderRecentTickets();
        renderCharts();
        // Future: Fetch data from the database using AJAX/Fetch API
      });
    </script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>
